{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport io from \"socket.io-client\";\nexport var SocketController = function () {\n  function SocketController(props) {\n    _classCallCheck(this, SocketController);\n\n    this.user = props.user;\n    this.updateUser = props.updateUser;\n    this.chats = props.chats;\n    this.updateChats = props.updateChats;\n    this.socket = props.socket;\n    this.loadEvents();\n  }\n\n  _createClass(SocketController, [{\n    key: \"loadEvents\",\n    value: function loadEvents() {\n      var _this = this;\n\n      console.log(\"laod events\");\n      this.socket.on(\"receiveMessage\", function (msg) {\n        return console.log(\"msg de \", msg.author.profile.username);\n\n        var chat = _this.chats.filter(function (c) {\n          return c.id === msg.chat.id;\n        })[0];\n\n        if (chat) {\n          chat.messages.push(msg);\n\n          _this.updateChats({\n            chats: _this.chats\n          });\n        }\n      });\n      this.socket.on(\"newChat\", function (_ref) {\n        var newChat = _ref.newChat;\n\n        _this.chats.push(newChat);\n\n        _this.updateChats({\n          chats: _this.chats\n        });\n      });\n      this.socket.on(\"readMessage\", function (payload) {\n        var chat = _this.chats.filter(function (c) {\n          return c.id === payload.chat.id;\n        })[0];\n\n        if (chat) {\n          chat.messages.filter(function (m) {\n            return m.read === false;\n          }).map(function (m) {\n            return m.read = true;\n          });\n\n          _this.updateChats({\n            chats: _this.chats\n          });\n        }\n      });\n    }\n  }], [{\n    key: \"sendHalkMessage\",\n    value: function sendHalkMessage() {\n      var timeNow = new Date().getTime();\n      var halkUser = {\n        id: \"0\",\n        phone: \"+00\",\n        profile: {\n          name: \"Halk\",\n          username: \"Halk\",\n          avatar: require(\"../../assets/images/icon.png\"),\n          bio: \"Official account of the team Halk\"\n        }\n      };\n      var halkChat = {\n        id: \"a384b2bc-1a3b-49d3-bdf5-1be72350c494\",\n        user: halkUser,\n        key: \"0000\",\n        messages: [{\n          author: halkUser,\n          content: \"Welcome to halk!\",\n          createdAt: timeNow,\n          id: \"\" + timeNow + Math.floor(Math.random() * (100000000 - 1000000 + 1) + 1000000),\n          read: false\n        }]\n      };\n      return halkChat;\n    }\n  }]);\n\n  return SocketController;\n}();\nexport function CreateSocketConnection(_ref2) {\n  var userId = _ref2.userId;\n  var socket = io(\"http://localhost:3000\", {\n    transports: [\"websocket\"],\n    auth: {\n      userId: userId\n    }\n  });\n  return socket;\n}","map":{"version":3,"names":["io","SocketController","props","user","updateUser","chats","updateChats","socket","loadEvents","console","log","on","msg","author","profile","username","chat","filter","c","id","messages","push","newChat","payload","m","read","map","timeNow","Date","getTime","halkUser","phone","name","avatar","require","bio","halkChat","key","content","createdAt","Math","floor","random","CreateSocketConnection","userId","transports","auth"],"sources":["/home/samuel/Documentos/projetos/mobile/halk/client/src/utils/socket.ts"],"sourcesContent":["import io from \"socket.io-client\";\nimport * as uuid from \"uuid\";\n\nexport class SocketController {\n  constructor(props) {\n    this.user = props.user;\n    this.updateUser = props.updateUser;\n    this.chats = props.chats;\n    this.updateChats = props.updateChats;\n    this.socket = props.socket;\n\n    this.loadEvents();\n  }\n\n  public loadEvents() {\n    console.log(\"laod events\");\n\n    this.socket.on(\"receiveMessage\", (msg) => {\n      return console.log(\"msg de \", msg.author.profile.username);\n      const chat = this.chats.filter((c) => c.id === msg.chat.id)[0];\n      if(chat) {\n        chat.messages.push(msg);\n        this.updateChats({ chats: this.chats });\n      }\n    });\n\n    this.socket.on(\"newChat\", ({ newChat}) => {\n      this.chats.push(newChat);\n      this.updateChats({ chats: this.chats });\n    });\n\n    this.socket.on(\"readMessage\", (payload) => {\n      const chat = this.chats.filter((c) => c.id === payload.chat.id)[0];\n      if(chat) {\n        chat.messages.filter((m) => m.read === false).map((m) => m.read = true);\n        this.updateChats({ chats: this.chats });\n      }\n    })\n  }\n\n  static sendHalkMessage() {\n    const timeNow = new Date().getTime();\n    const halkUser = {\n      id: \"0\",\n      phone: \"+00\",\n      profile: {\n        name: \"Halk\",\n        username: \"Halk\",\n        avatar: require(\"../../assets/images/icon.png\"),\n        bio: \"Official account of the team Halk\",\n      },\n    };\n\n    const halkChat = {\n      id: \"a384b2bc-1a3b-49d3-bdf5-1be72350c494\",\n      user: halkUser,\n      key: \"0000\",\n      messages: [\n        {\n          author: halkUser,\n          content: \"Welcome to halk!\",\n          createdAt: timeNow,\n          id: `${timeNow}${Math.floor(\n            Math.random() * (100000000 - 1000000 + 1) + 1000000\n          )}`,\n          read: false,\n        },\n      ],\n    };\n\n    return halkChat;\n  }\n}\n\nexport function CreateSocketConnection({ userId }) {\n  const socket = io(\"http://localhost:3000\", {\n    transports: [\"websocket\"],\n    auth: {\n      userId,\n    },\n  });\n\n  return socket;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}