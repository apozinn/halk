{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState, useContext } from \"react\";\nimport StatusBar from \"react-native-web/dist/exports/StatusBar\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { TextInput, Text } from \"../../src/components/Themed\";\nimport { UserContext } from \"../../src/contexts/user\";\nimport { ChatsContext } from \"../../src/contexts/chats\";\nimport Socket, { CreateSocketConnection } from \"../../src/utils/socket\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function Chat(_ref) {\n  var navigation = _ref.navigation,\n      route = _ref.route;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      socket = _useState2[0],\n      setSocket = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      messages = _useState4[0],\n      setMessages = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      text = _useState6[0],\n      setText = _useState6[1];\n\n  var _useState7 = useState(),\n      _useState8 = _slicedToArray(_useState7, 2),\n      chat = _useState8[0],\n      setChat = _useState8[1];\n\n  var _useContext = useContext(UserContext),\n      user = _useContext.user;\n\n  var _useContext2 = useContext(ChatsContext),\n      chats = _useContext2.chats;\n\n  useEffect(function () {\n    var chatId = route.params.id;\n    var socketConnection = CreateSocketConnection();\n    socketConnection.emit(\"joinRoom\", chatId);\n    setSocket(socketConnection);\n\n    if (chatId) {\n      var thisChat = chats.filter(function (c) {\n        return c.id === chatId;\n      });\n\n      if (thisChat) {\n        setChat(thisChat);\n      } else {\n        setChat(new Socket(socket).sendHalkMessage());\n      }\n\n      socketConnection.on(\"receiveMessage\", function (msg, client) {\n        if (thisChat) {\n          thisChat.messages.push(msg);\n        }\n\n        setMessages(function (oldMessages) {\n          return [].concat(_toConsumableArray(oldMessages), [msg]);\n        });\n      });\n    }\n  }, [user, chats]);\n  useEffect(function () {}, [messages]);\n\n  function sendMessage() {\n    var timeNow = new Date().getTime();\n    var message = {\n      author: user,\n      content: text,\n      createdAt: timeNow,\n      id: \"\" + timeNow + Math.floor(Math.random() * (100000000 - 1000000 + 1) + 1000000)\n    };\n    socket.emit(\"sendMessage\", {\n      room: chat.id,\n      message: message\n    });\n    setText(\"\");\n  }\n\n  return _jsxs(View, {\n    children: [_jsx(View, {\n      children: messages.map(function (msg, index) {\n        return _jsxs(Text, {\n          children: [msg.author.profile.name, \": \", msg.content]\n        }, index);\n      })\n    }), _jsxs(View, {\n      children: [_jsx(TextInput, {\n        placeholder: \"Mensagem...\",\n        value: text,\n        onChangeText: function onChangeText(value) {\n          return setText(value);\n        }\n      }), _jsx(TouchableOpacity, {\n        onPress: function onPress() {\n          return sendMessage();\n        },\n        children: _jsx(Text, {\n          children: \"Send\"\n        })\n      })]\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    marginTop: StatusBar.currentHeight\n  },\n  topContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: 5,\n    justifyContent: \"space-between\"\n  },\n  topContainerLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\"\n  },\n  topContainerRight: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\"\n  },\n  messageContainer: {\n    flex: 1,\n    marginHorizontal: 10,\n    flexDirection: \"column-reverse\",\n    marginBottom: 55\n  },\n  bottomContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    position: \"absolute\",\n    backgroundColor: \"rgb(18, 18, 18)\",\n    justifyContent: \"space-between\",\n    borderRadius: 50,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    padding: 5,\n    margin: 5\n  },\n  messageCard: {\n    borderWidth: 1,\n    borderColor: \"#222\"\n  },\n  myMessage: {\n    justifyContent: \"flex-end\",\n    flexDirection: \"revert\"\n  },\n  otherMessage: {\n    width: \"fit-content\",\n    maxWidth: \"85%\"\n  },\n  userIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 100,\n    marginHorizontal: 5\n  },\n  userProfile: {\n    flexDirection: \"row\",\n    alignItems: \"center\"\n  },\n  backButton: {\n    padding: 5,\n    borderRadius: 100\n  },\n  blueButton: {\n    backgroundColor: \"#2f95dc\",\n    padding: 8,\n    borderRadius: 100\n  },\n  othersMedias: {\n    flexDirection: \"row\",\n    alignItems: \"center\"\n  },\n  inputMessage: {\n    paddingVertical: 8,\n    width: \"100%\",\n    marginLeft: 10\n  },\n  message: {\n    padding: 7,\n    borderRadius: 20,\n    flexDirection: \"row\",\n    marginBottom: 10,\n    alignItems: \"flex-end\",\n    flexWrap: \"wrap\"\n  },\n  messageCreatedAt: {\n    fontSize: 10,\n    marginLeft: 5\n  },\n  buttonContentLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\"\n  }\n});","map":{"version":3,"names":["React","useEffect","useState","useContext","TextInput","Text","UserContext","ChatsContext","Socket","CreateSocketConnection","Chat","navigation","route","socket","setSocket","messages","setMessages","text","setText","chat","setChat","user","chats","chatId","params","id","socketConnection","emit","thisChat","filter","c","sendHalkMessage","on","msg","client","push","oldMessages","sendMessage","timeNow","Date","getTime","message","author","content","createdAt","Math","floor","random","room","map","index","profile","name","value","styles","StyleSheet","create","container","flex","marginTop","StatusBar","currentHeight","topContainer","flexDirection","alignItems","padding","justifyContent","topContainerLeft","topContainerRight","messageContainer","marginHorizontal","marginBottom","bottomContainer","position","backgroundColor","borderRadius","bottom","left","right","margin","messageCard","borderWidth","borderColor","myMessage","otherMessage","width","maxWidth","userIcon","height","userProfile","backButton","blueButton","othersMedias","inputMessage","paddingVertical","marginLeft","flexWrap","messageCreatedAt","fontSize","buttonContentLeft"],"sources":["/home/samuel/Documentos/projetos/mobile/halk/client/screens/chat/chat.tsx"],"sourcesContent":["import React, { useEffect, useState, useContext, useRef } from \"react\";\nimport {\n  Button,\n  StatusBar,\n  StyleSheet,\n  View,\n  Image,\n  Pressable,\n  ScrollView,\n  TouchableOpacity,\n} from \"react-native\";\nimport {\n  AntDesign,\n  Ionicons,\n  Feather,\n  FontAwesome,\n  MaterialIcons,\n  Fontisto,\n} from \"@expo/vector-icons\";\nimport { RootStackScreenProps } from \"../../types\";\nimport { TextInput, Text } from \"../../src/components/Themed\";\nimport { UserContext } from \"../../src/contexts/user\";\nimport { ChatsContext } from \"../../src/contexts/chats\";\nimport Socket, { CreateSocketConnection } from \"../../src/utils/socket\";\nimport { getColors } from \"../../constants/Colors\";\n\nexport default function Chat({\n  navigation,\n  route,\n}: RootStackScreenProps<\"Chat\">) {\n  const [socket, setSocket] = useState();\n  const [messages, setMessages] = useState([]);\n  const [text, setText] = useState(\"\");\n  const [chat, setChat] = useState();\n\n  const { user } = useContext(UserContext);\n  const { chats } = useContext(ChatsContext);\n\n  useEffect(() => {\n    const chatId = route.params.id;\n    const socketConnection = CreateSocketConnection();\n    socketConnection.emit(\"joinRoom\", chatId);\n    setSocket(socketConnection);\n\n    if (chatId) {\n      const thisChat = chats.filter((c) => c.id === chatId);\n\n      if(thisChat) {\n        setChat(thisChat);\n      } else {\n        setChat(new Socket(socket).sendHalkMessage());\n      }\n\n      socketConnection.on(\"receiveMessage\", (msg, client) => {\n        if(thisChat) {\n          thisChat.messages.push(msg);\n        }\n        setMessages((oldMessages) => [...oldMessages, msg]);\n      });\n    }\n  }, [user, chats]);\n\n  useEffect(() => {}, [messages]);\n\n  function sendMessage() {\n    const timeNow = new Date().getTime();\n    const message = {\n      author: user,\n      content: text,\n      createdAt: timeNow,\n      id: `${timeNow}${Math.floor(\n        Math.random() * (100000000 - 1000000 + 1) + 1000000\n      )}`,\n    };\n\n    socket.emit(\"sendMessage\", { room: chat.id, message });\n    setText(\"\");\n  }\n\n  return (\n    <View>\n      <View>\n        {messages.map((msg, index) => (\n          <Text key={index}>\n            {msg.author.profile.name}: {msg.content}\n          </Text>\n        ))}\n      </View>\n      <View>\n        <TextInput\n          placeholder=\"Mensagem...\"\n          value={text}\n          onChangeText={(value) => setText(value)}\n        />\n        <TouchableOpacity onPress={() => sendMessage()}>\n          <Text>Send</Text>\n        </TouchableOpacity>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    marginTop: StatusBar.currentHeight,\n  },\n  topContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: 5,\n    justifyContent: \"space-between\",\n  },\n  topContainerLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  topContainerRight: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  messageContainer: {\n    flex: 1,\n    marginHorizontal: 10,\n    flexDirection: \"column-reverse\",\n    marginBottom: 55,\n  },\n  bottomContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    position: \"absolute\",\n    backgroundColor: \"rgb(18, 18, 18)\",\n    justifyContent: \"space-between\",\n    borderRadius: 50,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    padding: 5,\n    margin: 5,\n  },\n  messageCard: {\n    borderWidth: 1,\n    borderColor: \"#222\",\n  },\n  myMessage: {\n    justifyContent: \"flex-end\",\n    flexDirection: \"revert\",\n  },\n  otherMessage: {\n    width: \"fit-content\",\n    maxWidth: \"85%\",\n  },\n  userIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 100,\n    marginHorizontal: 5,\n  },\n  userProfile: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  backButton: {\n    padding: 5,\n    borderRadius: 100,\n  },\n  blueButton: {\n    backgroundColor: \"#2f95dc\",\n    padding: 8,\n    borderRadius: 100,\n  },\n  othersMedias: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  inputMessage: {\n    paddingVertical: 8,\n    width: \"100%\",\n    marginLeft: 10,\n  },\n  message: {\n    padding: 7,\n    borderRadius: 20,\n    flexDirection: \"row\",\n    marginBottom: 10,\n    alignItems: \"flex-end\",\n    flexWrap: \"wrap\",\n  },\n  messageCreatedAt: {\n    fontSize: 10,\n    marginLeft: 5,\n  },\n  buttonContentLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}